<!DOCTYPE html>
<html lang="en">
	<style>
		.area-borders {
			fill: none;
			stroke: #fff;
			stroke-width: 0px;
		}

		.switch {
  			position: relative;
  			display: inline-block;
  			width: 32px;
  			height: 20px;
		}

		.switch input {
  			opacity: 0;
  			width: 0;
  			height: 0;
		}

		.slider {
  			position: absolute;
  			cursor: pointer;
  			top: 0;
 			left: 0;
  			right: 0;
  			bottom: 0;
  			background-color: #ccc;
  			-webkit-transition: .4s;
  			transition: .4s;
		}

		.slider:before {
			position: absolute;
			content: "";
			height: 12px;
			width: 12px;
			left: 4px;
			bottom: 4px;
			background-color: white;
			-webkit-transition: .4s;
			transition: .4s;
		}

		input:checked + .slider {
			background-color: #2196F3;
		}

		input:focus + .slider {
			box-shadow: 0 0 1px #2196F3;
		}

		input:checked + .slider:before {
			-webkit-transform: translateX(12px);
			-ms-transform: translateX(12px);
			transform: translateX(12px);
		}

		/* Rounded sliders */
		.slider.round {
			border-radius: 34px;
		}

		.slider.round:before {
			border-radius: 50%;
		}
	</style>
	<head>
		<meta charset="utf-8">
		<title>U.S. Map</title>
		<script type="text/javascript" src="d3.js"></script>
		<style type="text/css">
		</style>
	</head>
	<body style="background-color: rgb(253,253,253); margin:0px">
		<h1 style="text-align:center; color: white; font-size: 45px; background-color:#090C9B; margin:0px; padding:30px">Our Title Here</h1>
		<div style="display:flex; justify-content: space-evenly">
			<div style="border: #090C9B solid 2px; margin:20px; border-radius: 10px">
				<h2 style="text-align:center; background-color: #090C9B; color: white; margin: 0px; padding:20px; border-top-left-radius: 10px; border-top-right-radius: 10px">United State of America</h2>
				<div id='mapHere' style="width: 1000px; background-color: white; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px"></div>
				<div id='labelsHere' style="width: 1000px;"></div>
			</div>
			<div id='radio' style="border: #090C9B solid 2px; margin:20px; border-radius:10px; width: 30%">
				<h2 style="text-align:center; background-color: #090C9B; color: white; margin: 0px; margin-bottom:20px; padding:20px; border-top-left-radius: 10px; border-top-right-radius: 10px">Data Options</h2>
				<div style="padding-left:10px; padding-right:10px">
					<div style="display:flex; justify-content: flex-start">
						<strong>
							<p style="margin:0px">States &nbsp;</p>
						</strong>
						<label class="switch">
							<input id="stateCountyCheck" type="checkbox">
							<span class="slider round"></span>
						</label>
						<strong>
							<p style="margin:0px">&nbsp; Counties</p>
						</strong>
					</div>
					<br>
					<input type="radio" name="dataType" value="Population" id='pop' checked>Population</input>
					<br>
					<input type="radio" name="dataType" value="pid_3" id='pid3'>3 Point Party Identification</input>
					<br>
					<input type="radio" name="dataType" value="2016_vote" id='vote2016'>2016 Predisential Election Results</input>
					<br>
					<input type="radio" name="dataType" value="2012_vote" id='vote2012'>2012 Predisential Election Results</input>
					<br>
					<h3 style="text-align:center">Filters</h3>
					<br>
					<div style="display:flex; flex-direction: row; flex-wrap: wrap;">
						<div style="width: 50%">
							<h4 style="margin: 0px; padding-top: 15px;">Education</h4>
							<input type="checkbox" class="educ" value="1" id="no_hs">No HS</input>
							<br>
							<input type="checkbox" class="educ" value="2" id="hs_grad">High School Graduate</input>
							<br>
							<input type="checkbox" class="educ" value="3" id="some_colg">Some College</input>
							<br>
							<input type="checkbox" class="educ" value="4" id="yr2">2-Year</input>
							<br>
							<input type="checkbox" class="educ" value="5" id="yr4">4-Year</input>
							<br>
							<input type="checkbox" class="educ" value="6" id="post_grad">Post-Grad</input>
							<br>
						</div>
						<br>
						<div style="width: 50%">
							<h4 style="margin: 0px; padding-top: 15px;">Race</h4>
							<input type="checkbox" class="race" value="1" id="white">White</input>
							<br>
							<input type="checkbox" class="race" value="2" id="black">Black</input>
							<br>
							<input type="checkbox" class="race" value="3" id="hispanic">Hispanic</input>
							<br>
							<input type="checkbox" class="race" value="4" id="asian">Asian</input>
							<br>
							<input type="checkbox" class="race" value="5" id="native">Native American</input>
							<br>
							<input type="checkbox" class="race" value="8" id="mid_east">Middle Eastern</input>
							<br>
						</div>
						<br>
						<div style="width: 50%">
							<h4 style="margin: 0px; padding-top: 15px;">Generation (Birth Year)</h4>
							<input type="checkbox" class="birthyr" value="1900,1924" id="greatest">The "Greatest Generation" (1924 or earlier)</input>
							<br>
							<input type="checkbox" class="birthyr" value="1925,1945" id="silent">The "Silent Generation" (1925 - 1945)</input>
							<br>
							<input type="checkbox" class="birthyr" value="1946,1964" id="boomers">Baby Boomers (1946-1964)</input>
							<br>
							<input type="checkbox" class="birthyr" value="1965,1979" id="genx">Generation X (1965-1979)</input>
							<br>
							<input type="checkbox" class="birthyr" value="1980,2000" id="mill">Millennials (1980-2000)</input>
						</div>
						<br>
						<div style="width: 50%">
							<h4 style="margin: 0px; padding-top: 15px;">Sexuality</h4>
							<input type="checkbox" class="sexuality" value="1.0" id="hetero">Heterosexual/Straight</input>
							<br>
							<input type="checkbox" class="sexuality" value="2.0" id="lesbian">Lesbian/Gay Woman</input>
							<br>
							<input type="checkbox" class="sexuality" value="3.0" id="gay">Gay Man</input>
							<br>
							<input type="checkbox" class="sexuality" value="4.0" id="bi">Bisexual</input>
							<br>
						</div>
						<br>
						<div style="width: 50%; padding-top: 10px">
							<h4 style="margin: 0px; padding-top: 15px;">Gender</h4>
							<input type="checkbox" class="gender" value="1" id="male">Male</input>
							<br>
							<input type="checkbox" class="gender" value="2" id="female">Female</input>
							<br>
						</div>
						<br>
						<div style="width: 50%">
							<h4 style="margin: 0px; padding-top: 15px;">Transgender</h4>
							<input type="checkbox" class="trans" value="1.0" id="yes_trans">Yes</input>
							<br>
							<input type="checkbox" class="trans" value="2.0" id="no_trans">No</input>
							<br>
						</div>
						<br>
						<div style="width: 50%">
							<h4 style="margin: 0px; padding-top: 15px;">Marital Status</h4>
							<input type="checkbox" class="marstat" value="1.0" id="mar">Married</input>
							<br>
							<input type="checkbox" class="marstat" value="2.0" id="sep">Separated</input>
							<br>
							<input type="checkbox" class="marstat" value="3.0" id="div">Divorced</input>
							<br>
							<input type="checkbox" class="marstat" value="4.0" id="wid">Widowed</input>
							<br>
							<input type="checkbox" class="marstat" value="5.0" id="sing">Single</input>
							<br>
							<input type="checkbox" class="marstat" value="6.0" id="dom">Domestic Partnership</input>
							<br>
						</div>
						<br>
						<div style="width: 50%">
							<h4 style="margin: 0px; padding-top: 15px;">Employment</h4>
							<input type="checkbox" class="employ" value="1" id="full">Full-Time</input>
							<br>
							<input type="checkbox" class="employ" value="2" id="part">Part-Time</input>
							<br>
							<input type="checkbox" class="employ" value="3" id="temp">Temporarily Laid Off</input>
							<br>
							<input type="checkbox" class="employ" value="4" id="unemp">Unemployed</input>
							<br>
							<input type="checkbox" class="employ" value="5" id="retire">Retired</input>
							<br>
							<input type="checkbox" class="employ" value="6" id="dis">Permanently Disabled</input>
							<br>
							<input type="checkbox" class="employ" value="7" id="home">Homemaker</input>
							<br>
							<input type="checkbox" class="employ" value="8" id="stud">Sudent</input>
							<br>
						</div>
						<br>
						<div style="width: 50%">
							<h4 style="margin: 0px; padding-top: 15px;">Religion</h4>
							<input type="checkbox" class="religpew" value="1.0" id="prot">Protestant</input>
							<br>
							<input type="checkbox" class="religpew" value="2.0" id="roman">Roman Catholic</input>
							<br>
							<input type="checkbox" class="religpew" value="3.0" id="morm">Mormon</input>
							<br>
							<input type="checkbox" class="religpew" value="4.0" id="east_or_greek">Eastern or Greek Orthodox</input>
							<br>
							<input type="checkbox" class="religpew" value="5.0" id="jew">Jewish</input>
							<br>
							<input type="checkbox" class="religpew" value="6.0" id="mus">Muslim</input>
							<br>
							<input type="checkbox" class="religpew" value="7.0" id="bud">Buddhist</input>
							<br>
							<input type="checkbox" class="religpew" value="8.0" id="hindu">Hindu</input>
							<br>
							<input type="checkbox" class="religpew" value="9.0" id="ath">Atheist</input>
							<br>
							<input type="checkbox" class="religpew" value="10.0" id="agn">Agnostic</input>
							<br>
							<input type="checkbox" class="religpew" value="11.0" id="not">Nothing in Particular</input>
							<br>
							<input type="checkbox" class="religpew" value="12.0" id="else">Something Else</input>
							<br>
						</div>
						<br>
						<div style="width: 50%">
							<h4 style="margin: 0px; padding-top: 15px;">Family Income</h4>
							<input type="checkbox" class="faminc" value="1.0" id="lt10">Less than $10,000</input>
							<br>
							<input type="checkbox" class="faminc" value="2.0" id="ten">$10,000 - $19,999</input>
							<br>
							<input type="checkbox" class="faminc" value="3.0" id="twenty">$20,000 - $29,999</input>
							<br>
							<input type="checkbox" class="faminc" value="4.0" id="thirty">$30,000 - $39,999</input>
							<br>
							<input type="checkbox" class="faminc" value="5.0" id="fourty">$40,000 - $49,999</input>
							<br>
							<input type="checkbox" class="faminc" value="6.0" id="fifty">$50,000 - $59,999</input>
							<br>
							<input type="checkbox" class="faminc" value="7.0" id="sixty">$60,000 - $69,999</input>
							<br>
							<input type="checkbox" class="faminc" value="8.0" id="seventy">$70,000 - $79,999</input>
							<br>
							<input type="checkbox" class="faminc" value="9.0" id="eighty">$80,000 - $99,999</input>
							<br>
							<input type="checkbox" class="faminc" value="10.0" id="hundred">$100,000 - $119,999</input>
							<br>
							<input type="checkbox" class="faminc" value="11.0" id="hundred_20">$120,000 - $149,999</input>
							<br>
							<input type="checkbox" class="faminc" value="31.0" id="gt150">$150,000 or more</input>
							<br>
							<input type="checkbox" class="faminc" value="12.0" id="hundred_50">$150,000 - $199,999</input>
							<br>
							<input type="checkbox" class="faminc" value="13.0" id="two_hundred">$200,000 - $249,999</input>
							<br>
							<input type="checkbox" class="faminc" value="14.0" id="two_hundred_50">$250,000 - $349,999</input>
							<br>
							<input type="checkbox" class="faminc" value="15.0" id="three_hundred_50">$350,000 - $499,999</input>
							<br>
							<input type="checkbox" class="faminc" value="16.0" id="gt500">$500,000 or more</input>
							<br>
						</div>
						<br>
						<div style="width: 50%">
							<h4 style="margin: 0px; padding-top: 15px;">3 Point Party Identification</h4>
							<input type="checkbox" class="pid3" value="1.0" id="dem">Democrat</input>
							<br>
							<input type="checkbox" class="pid3" value="2.0" id="rep">Republican</input>
							<br>
							<input type="checkbox" class="pid3" value="3.0" id="ind">Independent</input>
							<br>
							<input type="checkbox" class="pid3" value="4.0" id="oth_pid3">Other</input>
							<br>
							<input type="checkbox" class="pid3" value="5.0" id="ns">Not Sure</input>
							<br>
						</div>
						<br>
						<div style="width: 50%">
							<h4 style="margin: 0px; padding-top: 15px;">2016 Predisential Election</h4>
							<input type="checkbox" class="CC16_410a" value="1.0" id="trump">Donald Trump (Republican)</input>
							<br>
							<input type="checkbox" class="CC16_410a" value="2.0" id="clinton">Hillary Clinton (Democrat)</input>
							<br>
							<input type="checkbox" class="CC16_410a" value="3.0" id="john">Gary Johnson (Libeertarian)</input>
							<br>
							<input type="checkbox" class="CC16_410a" value="4.0" id="stein">Jill Stein (Green)</input>
							<br>
							<input type="checkbox" class="CC16_410a" value="8.0" id="mcmul">Evan McMullin (Independent)</input>
							<br>
							<input type="checkbox" class="CC16_410a" value="5.0" id="oth_2016">Other</input>
							<br>
						</div>
						<br>
						<div style="width: 50%; padding-top: 15px;">
							<h4 style="margin: 0px">2012 Predidential Election</h4>
							<input type="checkbox" class="CC16_326" value="1.0" id="obama">Barack Obama</input>
							<br>
							<input type="checkbox" class="CC16_326" value="2.0" id="romney">Mitt Romney</input>
							<br>
							<input type="checkbox" class="CC16_326" value="3.0" id="se">Someone Else</input>
							<br>
						</div>
						<br>
						<div>
							<h4 style="margin: 0px; padding-top: 15px;">Clause</h4>
							<input type="radio" name="clause" value="AND" id="and" checked>AND</input>
							<br>
							<input type="radio" name="clause" value="OR" id="or">OR</input>
							<br>
						</div>
					</div>
					<br>
					<button style="margin-bottom: 10px" type="button" id="clrButton">Clear Selection</button>
					<button style="margin-bottom: 10px" type="button" id="clrFilter">Clear Filters</button>
				</div>
			</div>
		</div>
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="https://d3js.org/topojson.v2.min.js"></script>
		<script type="text/javascript">
			//basic svg setup
			var width = 1000;
			var height = 600;
			var path = d3.geoPath();
			var selected = new Map();
			const selectedColor = "#aaaaaa"
			const selectedWidth = "2px"
			const unselectedColor = "#fff"
			const unselectedWidth = "0px"

			const zoom = d3.zoom()
				.scaleExtent([1, 5])
				.translateExtent([[0,0], [width, height]])
				.extent([[0, 0], [width, height]])
				.on("zoom", zoomed);

			var svg = d3.select("#mapHere").append("svg").attr("width", width).attr("height", height).call(zoom);
			
			//used for labels
			var svg2 = d3.select("#labelsHere").append("svg").attr("width", width).attr("height", 30);
			var svg3 = d3.select("#labelsHere").append("svg").attr("width", 0).attr("height", 0);
			var svg4 = d3.select("#labelsHere").append("svg").attr("width", width).attr("height", 30);
			
			svg4.append("rect").attr("width", 15).attr("height", 15).attr("fill", "black").attr('x', width/2 - 60)
			svg4.append("text").text("No Data").attr('x', width/2 - 40).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")

			//distribution data var creation
			var popDist;
			var partyDist;
			var vote2016;
			var vote2012;
			var popDistCounty;
			var partyDistCounty;
			var vote2016County;
			var vote2012County;
			var filterID = new Array();
			var filterValues = new Array();
			var filterClass = new Array();
			var statesBool = true;
			var filterLength = 0;
			var filterClause = 'AND';

			var minPopState = 1000000;
			var maxPopState = 0;
			var minPopCounty = 1000000;
			var maxPopCounty = 0;

			var maxPartyCty = new Map()
			var max2016VtCty = new Map()
			var max2012VtCty = new Map()

			var popScale;
			var popCountyScale;
			var partyScale;
			var partyCountyScale;
			var vote2016Scale;
			var vote2016CountyScale;
			var vote2012Scale;
			var vote2012CountyScale;

			//clear button
			d3.select("#clrButton").on("click", clrButtonClick)
			d3.select("#clrFilter").on("click", clrFilterClick)

			//radio button setup
			var popradio = d3.select("#pop")
			popradio.on("change", function(){
				renderMap()
			})
			var pid3radio = d3.select("#pid3")
			pid3radio.on("change", function(){
				renderMap()
			})
			var vote2016radio = d3.select('#vote2016')
			vote2016radio.on("change", function(){
				renderMap()
			})
			var vote2012radio = d3.select('#vote2012')
			vote2012radio.on("change", function(){
				renderMap()
			})

			var inp = document.getElementsByTagName('input');

			for(var i = 0; i <inp.length; i++){
				if(inp[i].type == 'checkbox' && inp[i].id != 'stateCountyCheck'){
					d3.select('#' + inp[i].id).on("change", function(){
						handleAND(this, filterData);
					});
				}
			}

			var andradio = d3.select('#and');
			andradio.on("change", function(){
				clrFilterClick();
			});

			var orradio = d3.select('#or');
			orradio.on("change", function(){
				clrFilterClick();
			});

			function handleAND(obj, cb){
				if (filterClause == 'AND'){
					var boxes = document.getElementsByClassName(obj.className);
					for(var i = 0; i < boxes.length; i++){
						if(boxes[i].id != obj.id){
							if(boxes[i].checked == true){
								boxes[i].checked = false;
								filterValues.splice(filterID.indexOf(boxes[i].id), 1);
								filterClass.splice(filterID.indexOf(boxes[i].id), 1);
								filterID.splice(filterID.indexOf(boxes[i].id), 1);
								filterLength = -1
							}
						}
					}
				}
				cb && cb(obj);
			}

			//state county toggle
			var stateCountyCheckbox = d3.select("#stateCountyCheck")
			stateCountyCheckbox.on("change", function(){
				renderMap()
			})

			var idToCounty = new Map()
			var idToState = new Map()
			idToState.set(1, "Alabama")
			idToState.set(2, "Alaska")
			idToState.set(4, "Arizona")
			idToState.set(5, "Arkansas")
			idToState.set(6, "California")
			idToState.set(8, "Colorado")
			idToState.set(9, "Connecticut")
			idToState.set(10, "Delaware")
			idToState.set(11, "District of Columbia")
			idToState.set(12, "Florida")
			idToState.set(13, "Georgia")
			idToState.set(15, "Hawaii")
			idToState.set(16, "Idaho")
			idToState.set(17, "Illinois")
			idToState.set(18, "Indiana")
			idToState.set(19, "Iowa")
			idToState.set(20, "Kansas")
			idToState.set(21, "Kentucky")
			idToState.set(22, "Louisiana")
			idToState.set(23, "Maine")
			idToState.set(24, "Maryland")
			idToState.set(25, "Massachusetts")
			idToState.set(26, "Michigan")
			idToState.set(27, "Minnesota")
			idToState.set(28, "Mississippi")
			idToState.set(29, "Missouri")
			idToState.set(30, "Montana")
			idToState.set(31, "Nebraska")
			idToState.set(32, "Nevada")
			idToState.set(33, "New Hampshire")
			idToState.set(34, "New Jersey")
			idToState.set(35, "New Mexico")
			idToState.set(36, "New York")
			idToState.set(37, "North Carolina")
			idToState.set(38, "North Dakota")
			idToState.set(39, "Ohio")
			idToState.set(40, "Oklahoma")
			idToState.set(41, "Oregon")
			idToState.set(42, "Pennsylvania")
			idToState.set(44, "Rhode Island")
			idToState.set(45, "South Carolina")
			idToState.set(46, "South Dakota")
			idToState.set(47, "Tennessee")
			idToState.set(48, "Texas")
			idToState.set(49, "Utah")
			idToState.set(50, "Vermont")
			idToState.set(51, "Virginia")
			idToState.set(53, "Washington")
			idToState.set(54, "West Virginia")
			idToState.set(55, "Wisconsin")
			idToState.set(56, "Wyoming")

			//this is the line that actually draws the map. all vars and stuff should be above it. only functions should be below it.
			renderMap()
			
			function zoomed(){
				d3.select("g").attr("transform", d3.event.transform);
			}

			function clrButtonClick(){
				selected = new Map()
				renderMap()
			}

			function clrFilterClick(){
				for(var i = 0; i < filterID.length; i++){
					document.getElementById(filterID[i]).checked = false
				}
				filterID = new Array();
				filterValues = new Array();
				filterClass = new Array();
				loadAreas(statesBool);
			}
			
			function filter(index){
				if(filterClause == 'AND'){
					for(var i = 0; i < filterClass.length; i++){
						if(filterClass[i] == 'birthyr'){
							var range = filterValues[i].split(",");
							if(parseInt(range[0]) > parseInt(index[filterClass[i]]) || parseInt(index[filterClass[i]]) > parseInt(range[1])){
								return false;
							}
						}else{
							if (parseInt(index[filterClass[i]]) != parseInt(filterValues[i])){
								return false;
							}
						}
					}
					return true;
				}
				else{
					if(filterClass.length == 0){
						return true;
					}
					for(var i = 0; i < filterClass.length; i++){
						if(filterClass[i] == 'birthyr'){
							var range = filterValues[i].split(",");
							if(parseInt(range[0]) <= parseInt(index[filterClass[i]]) && parseInt(index[filterClass[i]]) <= parseInt(range[1])){
								return true;
							}
						}else{
							if (index[filterClass[i]] == filterValues[i]){
								return true;
							}
						}
					}
					return false;

				}
			}

			function filterData(obj){
				if(document.getElementById(obj.id).checked == true){
					filterClass.push(obj.className);
					filterID.push(obj.id);
					filterValues.push(obj.value);
				}else{
					filterValues.splice(filterID.indexOf(obj.id), 1);
					filterClass.splice(filterID.indexOf(obj.id), 1);
					filterID.splice(filterID.indexOf(obj.id), 1);
				}
				loadAreas(statesBool);
			}

			function getPopDist(poliData){
				var dist = new Object();
				poliData.forEach(function(index){
					if(filter(index)){
						let inputstate = parseInt(index.inputstate);
						if(inputstate){
							if(!(dist[inputstate])){
								dist[inputstate] = 0;
							}
							dist[inputstate] += 1;
						}
					}
				});

				maxPopState = 0
				minPopState = 1000000
				for(var key in dist){
					if(dist[key] > maxPopState){
						maxPopState = dist[key]
					} else if(dist[key] < minPopState){
						minPopState = dist[key]
					}
				}
				return dist;
			}

			function getPopDistCounty(poliData){
				let dist = new Object();
				poliData.forEach(function(index){
					if (filter(index)){	
						let county = parseInt(index.countyfips);
						if(county){
							if(!(dist[county])){
								dist[county] = 0;
							}
							dist[county] += 1;
						}
					}
				});

				maxPopCounty = 0
				minPopCounty = 1000000
				for(var key in dist){
					if(dist[key] > maxPopCounty){
						maxPopCounty = dist[key]
					} else if(dist[key] < minPopCounty){
						minPopCounty = dist[key]
					}
				}
				return dist;
			}

			function getParty(poliData){
				let dist = new Object();
				poliData.forEach(function(index){
					if (filter(index)){
						if (index.pid3 != ""){
							let inputstate = parseInt(index.inputstate);
							if(!dist[inputstate]){
								dist[inputstate] = new Array(8).fill(0);
							}
							let pid3 = parseInt(index.pid3)-1;
							dist[inputstate][pid3] += 1;
						}
					}
					
				});
				return dist;
			}

			function getPartyCounty(poliData){
				let dist = new Object();
				poliData.forEach(function(index){
					if (filter(index)){
						if(index.pid3 != ""){
							let county = parseInt(index.countyfips);
							if(!(dist[county])){
								dist[county] = new Array(8).fill(0);
							}
							let pid3 = parseInt(index.pid3)-1;
							dist[county][pid3] += 1;
						}
					}
				});
				return dist;
			}

			function maxParty(partyDist, d){
				var id = parseInt(d.id);
				if(partyDist[id]){
					var party = partyDist[id].indexOf(Math.max.apply(Math, partyDist[id]));
					//var value = (partyDist[id][party]/popDist[id]) * 255;
					var value = partyScale(partyDist[id][party])
					switch(party){
						case 0:
							return "rgb(0,0," + value + ")";
						case 1:
							return "rgb(" + value + ",0,0)";
						case 2:
							return "rgb(0," + value + ",0)";
						case 3:
							return "rgb(" + value + ",0," + value + ")";
						case 4:
							return "rgb(0," + value + "," + value + ")";
						case 5:
							return "rgb(" + value + "," + value + ",0)";
					}
				}
				return "rgb(0,0,0)";
			}

			function maxPartyCounty(partyDistCounty, d){
				var id = parseInt(d.countyfips);
				if(partyDistCounty[id]){	
					var party = partyDistCounty[id].indexOf(Math.max.apply(Math, partyDistCounty[id]));
					//var value = (partyDistCounty[id][party]/popDistCounty[id]) * 255;
					var value = partyCountyScale(partyDistCounty[id][party])
					switch(party){
						case 0:
							return "rgb(0,0," + value + ")";
						case 1:
							return "rgb(" + value + ",0,0)";
						case 2:
							return "rgb(0," + value + ",0)";
						case 3:
							return "rgb(" + value + ",0," + value + ")";
						case 4:
							return "rgb(0," + value + "," + value + ")";
						case 5:
							return "rgb(" + value + "," + value + ",0)";
					}
				}
				return "rgb(0,0,0)";
			}

			function getVote2016(poliData){
				var dist = new Object();
				poliData.forEach(function(index){
					if (filter(index)){
						var inputstate = parseInt(index.inputstate);
						if(!dist[inputstate]){
							dist[inputstate] = new Array(8).fill(0);
						}
						var pres = parseInt(index.CC16_410a)-1;
						if(pres<8){
							dist[inputstate][pres] += 1;
						}
					}
				});
				return dist;
			}

			function getVote2016County(poliData){
				let dist = new Object();
				poliData.forEach(function(index){
					if (filter(index)){
						var county = parseInt(index.countyfips);
						if(!(dist[county])){
							dist[county] = new Array(8).fill(0);
						}
						var pres = parseInt(index.CC16_410a)-1;
						if(pres < 8){
							dist[county][pres] += 1;
						}
					}
				});
				return dist;
			}

			function maxVote2016(vote2016, d){
				var id = parseInt(d.id);
				if(vote2016[id]){
					var pres = vote2016[id].indexOf(Math.max.apply(Math, vote2016[id]));
					//var value = (vote2016[id][pres]/popDist[id])*255;
					var value  = vote2016Scale(vote2016[id][pres])
					switch(pres){
						case 0:
							return "rgb(" + value + ",0,0)";
						case 1:
							return "rgb(0,0," + value + ")";
						case 2:
							return "rgb(0," + value + "," + value + ")";
						case 3:
							return "rgb(0," + value + ",0)";
						case 4:
							return "rbg(" + value + ",0,"+value+")";
						case 7:
							return "rgb(" + value + "," + value + ",0)";
					}
					return "rgb(0,0,0)";
				}

			}

			function maxVote2016County(vote2016County, d){
				var id = parseInt(d.countyfips);
				if(vote2016County[id]){
					var pres = vote2016County[id].indexOf(Math.max.apply(Math, vote2016County[id]));
					//var value = (vote2016County[id][pres]/popDistCounty[id])*255;
					var value = vote2016CountyScale(vote2016County[id][pres])
					switch(pres){
						case 0:
							return "rgb(" + value + ",0,0)";
						case 1:
							return "rgb(0,0," + value + ")";
						case 2:
							return "rgb(0," + value + "," + value + ")";
						case 3:
							return "rgb(0," + value + ",0)";
						case 4:
							return "rbg(" + value + ",0,"+value+")";
						case 7:
							return "rgb(" + value + "," + value + ",0)";
					}
				}
				return "rgb(0,0,0)";
			}

			function getVote2012(poliData){
				var dist = new Object();
				for(var i=0; i < dist.length; i++){
				}
				poliData.forEach(function(index){
					if (filter(index)){
						var inputstate = parseInt(index.inputstate);
						if(!dist[inputstate]){
							dist[inputstate] = new Array(3).fill(0);
						}
						var pres = parseInt(index.CC16_326)-1;
						if(pres < 3){
							dist[inputstate][pres] += 1;
						}
					}
				});
				return dist;
			}

			function getVote2012County(poliData){
				let dist = new Object();
				poliData.forEach(function(index){
					if (filter(index)){
						var county = parseInt(index.countyfips);
						if(!(dist[county])){
							dist[county] = new Array(3).fill(0);
						}
						var pres = parseInt(index.CC16_326)-1;
						if(pres < 3){
							dist[county][pres] += 1;
						}
					}
				});
				return dist;
			}

			function maxVote2012(vote2012, d){
				var id = parseInt(d.id);
				if(vote2012[id]){
					var pres = vote2012[id].indexOf(Math.max.apply(Math, vote2012[id]));
					//var value = (vote2012[id][pres]/popDist[id])*255;
					var value = vote2012Scale(vote2012[id][pres])
					switch(pres){
						case 0:
							return "rgb(0,0," + value + ")";
						case 1:
							return "rgb(" + value + ",0,0)";
						case 2:
							return "rgb(0," + value + ",0)";
					}
				}
				return "rgb(0,0,0)";
			}

			function countyNameMaker(poliData){
				poliData.forEach(function(d){
					if(!idToCounty.get(parseInt(d.countyfips))){
						idToCounty.set(parseInt(d.countyfips), d.countyname)
					}
				});
			}

			function highlightSelectedArea(element){
				if(selected.get(d3.select(element).attr("class")) === "undefined"){
					selected.set(d3.select(element).attr("class"), true)
				} else {
					selected.set(d3.select(element).attr("class"), !selected.get(d3.select(element).attr("class")))
				}

				if(selected.get(d3.select(element).attr("class"))){
					d3.select(element).attr("stroke", selectedColor).attr("stroke-width", selectedWidth)
				} else {
					d3.select(element).attr("stroke", unselectedColor).attr("stroke-width", unselectedWidth)
				}
			}
			
			function maxVote2012County(vote2012County, d){
				var id = parseInt(d.countyfips);
				var colors = [0,0,0];
				if(vote2012County[id]){
					var pres = vote2012County[id].indexOf(Math.max.apply(Math, vote2012County[id]));
					//var value = (vote2012County[id][pres]/popDistCounty[id])*255;
					var value = vote2012CountyScale(vote2012County[id][pres])
					switch(pres){
						case 0:
							return "rgb(0,0," + value + ")";
						case 1:
							return "rgb(" + value + ",0,0)";
						case 2:
							return "rgb(0," + value + ",0)";
					}
				}
				return "rgb(0,0,0)";
			}

			function makeRandomColor(){
				return "rgb(" + Math.ceil(Math.random()*255) + "," + Math.ceil(Math.random()*255) + "," + Math.ceil(Math.random()*255) + ")"
			}

			function loadData(file, cb){
				d3.tsv(file, function(error,data){
					if (error) throw error;
					cb(data);
				});
			}

			function makeScale(dist){
				var max = 0
				var min = 1000000
				for(var k in dist){
					if (dist[k] > max){
						max = dist[k]
					}
					else if (dist[k] < min){
						min = dist[k]
					}
				}
				return d3.scaleLinear().domain([min, max]).range([60, 255])
			}

			function makeScaleArrays(dist, minColor){
				var max = 0
				var min = 1000000
				for(var k in dist){
					var m = dist[k].indexOf(Math.max.apply(Math, dist[k]));
					m = dist[k][m]
					if (m > max){
						max = m
					}
					else if (m < min){
						min = m
					}
				}
				return d3.scaleLinear().domain([min, max]).range([minColor, 255])
			}

			function radioUpdate(d){
				if(d){
					if(popradio.property("checked") && !(stateCountyCheckbox.property("checked"))){
						let value = 0;
						if(popDist[parseInt(d.id)]){
							value = popDist[parseInt(d.id)];
						}
						return "rgb(0," + .5*popScale(value) + "," + popScale(value) + ")"
					} else if(pid3radio.property("checked")  && !(stateCountyCheckbox.property("checked"))){
						return maxParty(partyDist, d);
					} else if(vote2016radio.property("checked") && !(stateCountyCheckbox.property("checked"))){
						return maxVote2016(vote2016, d);
					} else if(vote2012radio.property("checked") && !(stateCountyCheckbox.property("checked"))){
						return maxVote2012(vote2012, d);
					}else if(popradio.property("checked") && stateCountyCheckbox.property("checked")){
						return "rgb(0," + .5*popCountyScale(popDistCounty[parseInt(d.id)]) + "," + popCountyScale(popDistCounty[parseInt(d.id)]) + ")"
					}else if(pid3radio.property("checked")  && stateCountyCheckbox.property("checked")){
						if(!maxPartyCty.get(parseInt(d.id))){
							return "rgb(0,0,0)"
						}
						return maxPartyCty.get(parseInt(d.id));
					}else if(vote2016radio.property("checked") && stateCountyCheckbox.property("checked")){
						if(!max2016VtCty.get(parseInt(d.id))){
							return "rgb(0,0,0)"
						}
						return max2016VtCty.get(parseInt(d.id))
					}else if(vote2012radio.property("checked") && stateCountyCheckbox.property("checked")){
						if(!max2012VtCty.get(parseInt(d.id))){
							return "rgb(0,0,0)"
						}
						return max2012VtCty.get(parseInt(d.id))
					}
				}

			}

			function renderMap(){
				if(stateCountyCheckbox.property("checked")){
					statesBool = false;
				} else {
					statesBool = true;
				}
				loadAreas(statesBool);
			}

			function loadAreas(statesBool){
				loadData('data/output.tsv', function(poliData){
				if(popDistCounty === undefined || filterLength != filterClass.length || (filterClause == 'AND' && document.getElementById('and').checked == false) || (filterClause == 'OR' && document.getElementById('or').checked == false)){
					if(document.getElementById('and').checked == true){
						filterClause = 'AND';
					} else {
						filterClause = 'OR';
					}
					filterLength = filterClass.length;
					
					popDist = getPopDist(poliData);
					popScale = makeScale(popDist);
					
					popDistCounty = getPopDistCounty(poliData);
					popCountyScale = makeScale(popDistCounty);

					partyDistCounty = getPartyCounty(poliData);
					partyCountyScale = makeScaleArrays(partyDistCounty, 120)

					vote2016County = getVote2016County(poliData);
					vote2016CountyScale = makeScaleArrays(vote2016County, 120);

					vote2012County = getVote2012County(poliData);
					vote2012CountyScale = makeScaleArrays(vote2012County, 120);

					partyDist = getParty(poliData);
					partyScale = makeScaleArrays(partyDist, 120);

					vote2016 = getVote2016(poliData);
					vote2016Scale = makeScaleArrays(vote2016, 80);

					vote2012 = getVote2012(poliData);
					vote2012Scale = makeScaleArrays(vote2012, 80);

					countyNameMaker(poliData);
					poliData.forEach(function(d){
						maxPartyCty.set(parseInt(d.countyfips), maxPartyCounty(partyDistCounty, d))
						max2016VtCty.set(parseInt(d.countyfips), maxVote2016County(vote2016County, d))
						max2012VtCty.set(parseInt(d.countyfips), maxVote2012County(vote2012County, d))
					});
				}
				d3.json("https://d3js.org/us-10m.v1.json", function(error, us) {
					if (error) throw error;
					svg.selectAll("g").remove()
					svg.selectAll("path").remove()
					if(statesBool){
						svg.append("g")
						.attr("class", "states")
						.selectAll("path")
						.data(topojson.feature(us, us.objects.states).features)
						.enter().append("path")
						.attr("d", path)
						.attr("class", function(d){
							return d.id
						}).attr("fill", function(d){
							return radioUpdate(d)
						}).append("title").text(function(d){
							return idToState.get(parseInt(d.id))
						})
					} else {
						svg.append("g")
						.attr("class", "counties")
						.selectAll("path")
						.data(topojson.feature(us, us.objects.counties).features)
						.enter().append("path")
						.attr("d", path)
						.attr("class", function(d){
							return d.id
						}).attr("fill", function(d){
							return radioUpdate(d)
						}).append("title").text(function(d){
							return idToCounty.get(parseInt(d.id))
						})
					}

					svg.selectAll("path")
						.attr("stroke", function(){
							if(selected.get(d3.select(this).attr("class"))){
								return selectedColor
							} else {
								return unselectedColor
							}
						}).attr("stroke-width", function(){
							if(selected.get(d3.select(this).attr("class"))){
								return selectedWidth
							} else {
								return unselectedWidth
							}
						}).on("click", function(){
							highlightSelectedArea(this)
						}).on("mouseover", function(){
							//d3.select(this).attr("fill", "orange");
							d3.select(this).attr("stroke", "orange").attr("stroke-width", selectedWidth)
						}).on("mouseout", function(){
							/*d3.select(this).attr("fill", function(d){
								return radioUpdate(d)
							});*/
							highlightSelectedArea(this)
							highlightSelectedArea(this)
						})

					svg.append("path")
						.attr("class", "area-borders")
						.attr("d", path(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; })));
					
					svg2.selectAll("*").remove()
					svg3.attr("height", 0).attr("width", 0)

					if(popradio.property("checked") && !stateCountyCheckbox.property("checked")){
						svg2.append("text").text(minPopState).attr('x', width/2 - 70).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(0," + .5*popScale(minPopState) + "," + popScale(minPopState) + ")").attr('x', width/2 - 45)
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(0," + .5*popScale((maxPopState - minPopState)/5 + minPopState) + "," + popScale((maxPopState - minPopState)/5 + minPopState) + ")").attr('x', width/2 - 30)
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(0," + .5*popScale(2*(maxPopState - minPopState)/5 + minPopState) + "," + popScale(2*(maxPopState - minPopState)/5 + minPopState) + ")").attr('x', width/2 - 15)
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(0," + .5*popScale(3*(maxPopState - minPopState)/5 + minPopState) + "," + popScale(3*(maxPopState - minPopState)/5 + minPopState) + ")").attr('x', width/2)
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(0," + .5*popScale(4*(maxPopState - minPopState)/5 + minPopState) + "," + popScale(4*(maxPopState - minPopState)/5 + minPopState) + ")").attr('x', width/2 + 15)
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(0," + .5*popScale(maxPopState) + "," + popScale(maxPopState) + ")").attr('x', width/2 + 30)
						svg2.append("text").text(maxPopState).attr('x', width/2 + 55).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")
					} else if(popradio.property("checked") && stateCountyCheckbox.property("checked")){
						svg2.append("text").text(minPopCounty).attr('x', width/2 - 70).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(0," + .5*popCountyScale(minPopCounty) + "," + popCountyScale(minPopCounty) + ")").attr('x', width/2 - 45)
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(0," + .5*popCountyScale((maxPopCounty - minPopCounty)/5 + minPopCounty) + "," + popCountyScale((maxPopCounty - minPopCounty)/5 + minPopCounty) + ")").attr('x', width/2 - 30)
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(0," + .5*popCountyScale(2*(maxPopCounty - minPopCounty)/5 + minPopCounty) + "," + popCountyScale(2*(maxPopCounty - minPopCounty)/5 + minPopCounty) + ")").attr('x', width/2 - 15)
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(0," + .5*popCountyScale(3*(maxPopCounty - minPopCounty)/5 + minPopCounty) + "," + popCountyScale(3*(maxPopCounty - minPopCounty)/5 + minPopCounty) + ")").attr('x', width/2)
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(0," + .5*popCountyScale(4*(maxPopCounty - minPopCounty)/5 + minPopCounty) + "," + popCountyScale(4*(maxPopCounty - minPopCounty)/5 + minPopCounty) + ")").attr('x', width/2 + 15)
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(0," + .5*popCountyScale(maxPopCounty) + "," + popCountyScale(maxPopCounty) + ")").attr('x', width/2 + 30)
						svg2.append("text").text(maxPopCounty).attr('x', width/2 + 55).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")
					}
					
					if(pid3radio.property("checked")){
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "blue").attr('x', width/4 - 60)
						svg2.append("text").text("Democrat").attr('x', width/4 - 40).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")
						
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "red").attr('x', 2*width/4 - 60)
						svg2.append("text").text("Republican").attr('x', 2*width/4 - 40).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")
						
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "green").attr('x', 3*width/4 - 60)
						svg2.append("text").text("Independent").attr('x', 3*width/4 - 40).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")
					}

					if(vote2016radio.property("checked")){
						svg3.attr("height", 30).attr("width", width)
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "red").attr('x', width/4 - 60)
						svg2.append("text").text("Donald Trump").attr('x', width/4 - 40).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")
						
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "blue").attr('x', 2*width/4 - 60)
						svg2.append("text").text("Hillary Clinton").attr('x', 2*width/4 - 40).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")
						
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(0, 200, 200)").attr('x', 3*width/4 - 60)
						svg2.append("text").text("Gary Johnson").attr('x', 3*width/4 - 40).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")
						
						svg3.append("rect").attr("width", 15).attr("height", 15).attr("fill", "green").attr('x', width/4 - 60)
						svg3.append("text").text("Jill Stein").attr('x', width/4 - 40).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")
						
						svg3.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(200, 200, 0)").attr('x', 2*width/4 - 60)
						svg3.append("text").text("Evan McMullin").attr('x', 2*width/4 - 40).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")
						
						svg3.append("rect").attr("width", 15).attr("height", 15).attr("fill", "rgb(200, 0, 200)").attr('x', 3*width/4 - 60)
						svg3.append("text").text("Other").attr('x', 3*width/4 - 40).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")
					}

					if(vote2012radio.property("checked")){
						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "blue").attr('x', width/4 - 60)
						svg2.append("text").text("Barack Obama").attr('x', width/4 - 40).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")

						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "red").attr('x', 2*width/4 - 60)
						svg2.append("text").text("Mitt Romney").attr('x', 2*width/4 - 40).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")

						svg2.append("rect").attr("width", 15).attr("height", 15).attr("fill", "green").attr('x', 3*width/4 - 60)
						svg2.append("text").text("Someone Else").attr('x', 3*width/4 - 40).attr('y', 15).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "black")
					}
				});
				});
			}
        </script>
    </body>
</html>
