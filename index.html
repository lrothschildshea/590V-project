<!DOCTYPE html>
<html lang="en">
	<style>
		.state-borders {
			fill: none;
			stroke: #fff;
			stroke-width: 0.5px;
		}
	</style>
	<head>
		<meta charset="utf-8">
		<title>D3: Axis moved to the bottom</title>
		<script type="text/javascript" src="d3.js"></script>
		<style type="text/css">
		</style>
	</head>
	<body>
		<div style="display:flex">
			<div id='mapHere' style="justify-content: flex-start; border: black solid 1px;"></div>
			<div id='radio' style="justify-content: flex-end; border: black solid 1px;">
				<input type="radio" name="dataType" value="Population" id='pop' checked>Population</input>
				<br>
				<input type="radio" name="dataType" value="2016_vote" id='vote2016'>2016 Presidential Vote</input>
			</div>
		</div>
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="https://d3js.org/topojson.v2.min.js"></script>
		<script type="text/javascript">
			//basic svg setup
			var width = 1000;
			var height = 600;
			var svg = d3.select("#mapHere").append("svg").attr("width", width).attr("height", height);
			var path = d3.geoPath();

			//distribution data var creation
			var popDist;
			var tempdata = []

			//radio button setup
			var popradio = d3.select("#pop")
			popradio.on("change", radioUpdate)
			var vote2016radio = d3.select("#vote2016")
			vote2016radio.on("change", radioUpdate)
			

			function getPopDist(poliData){
				var dist = new Array(57).fill(0)
				poliData.forEach(function(index){
					dist[index.inputstate] += 1
				})
				return dist
			}

			function makeNewColors(){
				return "rgb(" + Math.ceil(Math.random()*255) + "," + Math.ceil(Math.random()*255) + "," + Math.ceil(Math.random()*255) + ")"
			}

			function loadData(file, cb){
				d3.tsv(file, function(error,data){
					if (error) throw error;
					cb(data)
				});
			}

			function radioUpdate(){
				d3.selectAll("path").attr("fill", function(d){
					if(popradio.property("checked")){
						return "rgb(" + popDist[parseInt(d.id)]/10 + ",0," + popDist[parseInt(d.id)]/10 + ")"
					} else if(vote2016radio.property("checked")){
						return tempdata[parseInt(d.id)]
					}	
				})
			}

			loadData('data/output.tsv', function(poliData){
				d3.json("https://d3js.org/us-10m.v1.json", function(error, us) {
					if (error) throw error;
					popDist = getPopDist(poliData);
					tempdata = []
					for(i=0; i < 51; i++){
						tempdata.push(makeNewColors())
					}
					svg.append("g")
						.attr("class", "states")
						.selectAll("path")
						.data(topojson.feature(us, us.objects.states).features)
						.enter().append("path")
						.attr("d", path)
						.attr("class", function(d){
							return d.id
						})
						.attr("fill", function(d){
							return "rgb(" + popDist[parseInt(d.id)]/10 + ",0," + popDist[parseInt(d.id)]/10 + ")"
						});

					svg.append("path")
						.attr("class", "state-borders")
						.attr("d", path(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; })));

					svg.select("g").selectAll("path")
						.on("click", function(){
							//change the current data here
							d3.select(this).attr("fill", makeNewColors)
						})
				});
			});
        </script>
    </body>
</html>
